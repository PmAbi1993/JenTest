name: BuildÂ andÂ Test

on:
  push:
    branches: [ main, develop, 'feature/**' ]
  pull_request:
    branches: [ main, develop ]

concurrency:
  group: ${{ github.workflow }}â€‘${{ github.ref }}
  cancel-in-progress: true

jobs:
  build-and-test:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4

      - uses: maxim-lobanov/setup-xcode@v1
        with: { xcode-version: '16.2' }

      # ðŸ”‘ NEW: ensure an iOS runtime exists
      - name: Install iOS simulator runtime if missing
        run: |
          if ! xcrun simctl list runtimes | grep -q "iOS"; then
            echo "Downloading latest iOS runtimeâ€¦"
            sudo xcodebuild -downloadPlatform iOS      # or add -buildVersion 18.2
          fi

      - id: sim
        uses: futureware-tech/simulator-action@v4
        with:
          model: 'iPhone 15'
          wait_for_boot: true
          erase_before_boot: true

      - name: Build & test
        run: |
          set -o pipefail
          xcodebuild \
            -scheme JenTest \
            -destination "id=${{ steps.sim.outputs.udid }}" \
            test | xcpretty --test --color
